<%-- 
    Document   : accountList
    Created on : 08 22, 16, 11:37:13 PM
    Author     : SAM
--%>

<%@page import="java.sql.Array"%>
<%@page import="java.io.PrintWriter"%>
<%@page import="java.sql.Statement"%>
<%@page import="java.sql.ResultSet"%>
<%@page import="java.sql.DriverManager"%>
<%@page import="java.sql.Connection"%>
<%@page contentType="text/html" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
    <head>
        <link href="css/accountList.css" rel="stylesheet" type="text/css">
        
    </head>
    <body>
	<%@include file="../static-page/navbar.jsp" %>
        
        <%if (session.getAttribute("account_type").equals("admin") || session.getAttribute("account_type").equals("employee")){%>
                
	<header id="login-header" style="background-image: url(img/desk.png); background-size: cover;">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 text-center">
                        <h1>Account List</h1>
                    </div>
                </div>
            </div>
	</header>

    
        <table align = "center">
            <thead>
                <th> <b>ACCOUNT NUMBER</b> </th>
                <th> <b>USERNAME</b> </th>
                <th> <b>PASSWORD</b> </th>
                <th> <b>FULL NAME</b> </th>
                <th> <b>E-MAIL</b> </th>
                <th> <b>MOBILE NO.</b> </th>
                <th> <b>TELEPHONE NO.</b> </th>
                <th> <b>ADDRESS</b> </th>
                <th> <b>ACCOUNT TYPE</b> </th>
                <th> <b>ACCOUNT STATUS</b> </th>
                <th> <b>EMPLOYEE TYPE</b> </th>
            </tr>
        
        
        <%
            try
            {
                Class.forName("com.mysql.jdbc.Driver");
                String url = "jdbc:mysql://localhost/tsppi_db2";
                String username = "root";
                String password = "tsppi_password";
                String query = "select * from account";
                Connection conn = DriverManager.getConnection(url,username,password);
                Statement stmt = conn.createStatement();
                ResultSet rs = stmt.executeQuery(query);
                                
                while(rs.next())
                {
                    int accountNum = rs.getInt("account_type_id");
                    String accountType = "";
                    String jobType = "";
                    int employeeType = 0;
                    boolean userAdmin = true;
                    int idType = 0;
                                        
                    Statement stmtClient = conn.createStatement();
                    ResultSet idTypeRS = stmtClient.executeQuery("select * FROM type_of_account");
                                        
                    while(idTypeRS.next())
                    {
                        int idIndex = idTypeRS.getRow();
                        idType = idTypeRS.getInt("account_type_id");
                        
                        if (rs.getInt("account_type_id") == idTypeRS.getInt("account_type_id"))
                        {  
                            accountType = idTypeRS.getString("account_type");
                        }
                    }
                    
                    ResultSet employeeTypeRS = stmtClient.executeQuery("select * FROM employee");
                    
                    while(employeeTypeRS.next())
                    {
                        if(rs.getInt("account_num") == employeeTypeRS.getInt("account_num"))
                        {
                            employeeType = employeeTypeRS.getInt("job_id");
                            
                            Statement stmtJob = conn.createStatement();
                            
                            ResultSet jobTypeRS = stmtJob.executeQuery("select * FROM job_position");
                            
                            while(jobTypeRS.next())
                            {
                                if (employeeType == jobTypeRS.getInt("job_id"))
                                {
                                    jobType = jobTypeRS.getString("job_type");
                                    
                                    jobTypeRS.afterLast();
                                }
                            }
                            
                            employeeTypeRS.afterLast();
                        }else{
                            jobType = "";
                        }
                    }
                    
                    String status = "";
                    
                    if (rs.getInt("account_status") == 0)
                    {
                        status = "Deactivated";
                    }else{
                        status = "Activated";
                    }
                    
                    if (rs.getInt("account_type_id") != 2 && session.getAttribute("account_type").equals("admin"))
                    {
                        %>
                        <tr>
                            <td><%=rs.getString("account_num")%></td>
                            <td><%=rs.getString("USERNAME")%></td>
                            <td><%=rs.getString("password")%></td>
                            <td><%=rs.getString("first_name") + " " + rs.getString("last_name")%></td>
                            <td><%=rs.getString("email")%></td>
                            <td><%=rs.getString("mobile")%></td>
                            <td><%=rs.getString("telephone")%></td>
                            <td><%=rs.getString("address")%></td>
                            <td><% out.println(accountType);%></td>
                            <td><% out.println(status); %></td>
                            <td><% out.println(jobType); %></td>
                        </tr>
                        <%
                    }else{
                        %>
                        <tr>
                            <td><%=rs.getString("account_num")%></td>
                            <td><%=rs.getString("USERNAME")%></td>
                            <td><%=rs.getString("password")%></td>
                            <td><%=rs.getString("first_name") + " " + rs.getString("last_name")%></td>
                            <td><%=rs.getString("email")%></td>
                            <td><%=rs.getString("mobile")%></td>
                            <td><%=rs.getString("telephone")%></td>
                            <td><%=rs.getString("address")%></td>
                            <td><% out.println(accountType);%></td>
                            <td><% out.println(status); %></td>
                            <td><% out.println(jobType); %></td>
                        </tr>
                        <%
                    }
                }
            }catch (Exception e)
            {
                e.printStackTrace();
            }   
        %>
        <%}%>
        </table>
        
        <form action="Logout" method="post">
            <input type="submit" name="logout" value="Log out">
        </form>
    </body>
</html>
